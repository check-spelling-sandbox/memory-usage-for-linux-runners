name: info

on:
  push:
  workflow_dispatch:

jobs:
  info:
    runs-on: ubuntu-latest
    steps:
      - name: ps
        run: |
          (
            echo '## ps'
            echo '```'
            ps aux
            echo '```'
          ) >> $GITHUB_STEP_SUMMARY

      - name: systemctl
        run: |
          (
            echo '## systemctl'
            echo '```'
            systemctl --type=service --state=running | cat
            echo '```'
          ) >> $GITHUB_STEP_SUMMARY

      - name: free
        run: |
          (
            echo '## free'
            echo '```'
            free -h
            free
            echo '```'
          ) >> $GITHUB_STEP_SUMMARY
      
      - name: stop services
        run: |
          (
            echo '## systemctl stop ...'
            echo '```'
            sudo systemctl disable php8.1-fpm mono-xsp4 walinuxagent multipathd walinuxagent chrony cron getty@tty1 networkd-dispatcher rsyslog serial-getty@ttyS0 snapd
            sudo systemctl stop php8.1-fpm mono-xsp4 walinuxagent multipathd walinuxagent chrony cron getty@tty1 networkd-dispatcher rsyslog serial-getty@ttyS0 snapd
            sudo killall mono
            echo '```'
          ) >> $GITHUB_STEP_SUMMARY

      - name: free
        run: |
          (
            echo '## free'
            echo '```'
            free -h
            free
            echo '```'
          ) >> $GITHUB_STEP_SUMMARY
      
      - name: ps
        run: |
          (
            echo '## ps'
            echo '```'
            ps aux
            echo '```'
          ) >> $GITHUB_STEP_SUMMARY

      - name: systemctl
        run: |
          (
            echo '## systemctl'
            echo '```'
            systemctl --type=service --state=running | cat
            echo '```'
          ) >> $GITHUB_STEP_SUMMARY

      - name: pstree
        run: |
          (
            echo '## pstree'
            echo '```'
            sudo pstree -a -S -t -u -Z
            echo '```'
          ) >> $GITHUB_STEP_SUMMARY
